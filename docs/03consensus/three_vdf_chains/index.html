<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">3.8 Three VDF Chains | Chia Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://cpp6d.github.io/chia-docs//docs/03consensus/three_vdf_chains"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="3.8 Three VDF Chains | Chia Documentation"><meta data-react-helmet="true" name="description" content="If we only used one VDF (for the reward chain), the inclusion or exclusion of blocks would allow control of the challenge for the next slot. This means that an attacker could try many different combinations of blocks, and choose the challenge that suits them best, to obtain more wins in the next slot."><meta data-react-helmet="true" property="og:description" content="If we only used one VDF (for the reward chain), the inclusion or exclusion of blocks would allow control of the challenge for the next slot. This means that an attacker could try many different combinations of blocks, and choose the challenge that suits them best, to obtain more wins in the next slot."><link data-react-helmet="true" rel="shortcut icon" href="/img/chia_leaf_green.svg"><link data-react-helmet="true" rel="canonical" href="https://cpp6d.github.io/chia-docs//docs/03consensus/three_vdf_chains"><link data-react-helmet="true" rel="alternate" href="https://cpp6d.github.io/chia-docs//docs/03consensus/three_vdf_chains" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cpp6d.github.io/chia-docs//docs/03consensus/three_vdf_chains" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.864117c7.css">
<link rel="preload" href="/assets/js/runtime~main.73889518.js" as="script">
<link rel="preload" href="/assets/js/main.7dba6002.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/chia-docs-icon.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/chia-docs-icon.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title"> Chia Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/01introduction/what-is-chia">Docs</a><a href="https://www.chia.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia.net</a><a href="https://github.com/Chia-Network/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia Github</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">1 - Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">2 - Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">3 - Consensus Algorithm</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/consensus_intro">3.1 Chia Consensus Introduction</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/proof-of-space">3.2 Proof of Space</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/vdfs">3.3 VDFs</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/challenges">3.4 Challenges</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/signage_points_and_infusion_points">3.5 Signage Points and Infusion Points</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/harvester_algorith">3.6 Harvester Algorithm</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/multiple_blocks">3.7 Multiple Blocks</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/03consensus/three_vdf_chains">3.8 Three VDF Chains</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/overflow_blocks">3.9 Overflow Blocks and Weight</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/foliage">3.10 Foliage</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/epochs">3.11 Epoch and Difficulty Adjustment</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/light_clients">3.12 Light Clients</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/timelords">3.13 Timelord Algorithm</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/attacks_and_countermeasures">3.14 Relevant Attacks and Countermeasures</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/03consensus/analysis">3.15 Analysis</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">4 - Coin Set Model</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">5 - Block Validation</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">6 - Mempool</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">7 - Networking</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">8 - Serialization</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">9 - Keys and Signatures</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">10 - Protocol</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">11 - Pool Protocol</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">12 - RPC APIs</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">13 - Command Line Interface</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">14 - Python Implementation</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">15 - Resources</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>3.8 Three VDF Chains</h1></header><p>If we only used one VDF (for the reward chain), the inclusion or exclusion of blocks would allow control of the challenge for the next slot. This means that an attacker could try many different combinations of blocks, and choose the challenge that suits them best, to obtain more wins in the next slot.</p><p>These types of attacks are called grinding attacks, and they are one of the main difficulties of changing from Proof of Work to Proof of Space or Proof of Stake. More detail is provided in <a title="Section 3.14: Relevant Attacks and Countermeasures" href="/docs/03consensus/attacks_and_countermeasures">Section 3.14</a>.</p><p>To mitigate this, the challenges will be based only on the first block to be infused in a slot.</p><figure><img src="/img/multiple_chains.png" alt="drawing"><figcaption>Figure 8: The three VDF chains for 1+ challenges.<p>cc = challenge chain, ic = infused challenge chain, rc = reward chain,</p><p>sp = signage point, B = block, c = challenge, r = reward</p><p>An attacker can manipulate the reward chain results but this has no effect on c2, and therefore has no effect on the PoSpace lottery.</p></figcaption></figure><p>There is a lot going on in this diagram! Let&#x27;s break it down.</p><p>There are 4 <strong>blocks</strong>: B1, B2, B3, and B4. Farmers create these blocks. The blocks have pointers (the arrows), and the data the pointers are pointing to is all contained within the blocks themselves. At least 16 blocks have been created in the diagram&#x27;s sub-slot, but we don’t draw all of them due to space constraints.</p><p>The challenge chain and the reward chain each create 64 signage points, released every 9.375 seconds (on average) by timelords. Blocks must include the signage point VDFs (which mark the signage points) for both chains.</p><p>The timelords send their VDF output to their full node, which adds it into an EndOfSubSlotBundle. This bundle includes the output from each chain (for example c1, ic1, and r1 in the diagram). The bundle is propagated to all other full nodes. Blocks must also include the infusion point VDFs for all three chains.</p><p>The challenge chain broadcasts the challenges (c1 and c2). The same chain also executes the VDF from the start of the sub-slot to the end with nothing infused into it (the circles are VDF proofs but they do not interrupt the VDF). That is, in the challenge chain, the &quot;lottery&quot; is completely pre-determined, and not affected by blocks in the slot, until the end of the slot.</p><p>The reward chain infuses every block that is included.</p><p>The chain in the middle is called the <strong>infused challenge chain</strong>. It starts at the first infused block for each challenge, and goes on until the end of the slot.</p><p>Recall that a <strong>slot</strong> must have at least 16 reward-chain blocks. A sub-slot doesn&#x27;t have a minimum number of blocks (though it targets 32 blocks). Instead, a sub-slot always ends when sub-slot_iterations has been reached (this is targeted to take 10 minutes).</p><p>Because a sub-slot is targeted to produce more than 16 blocks, a slot usually only needs one sub-slot to meet its minimum-block requirement, but that is not always the case. For example, we may have only 10 blocks in a sub-slot, and then 3 and then 7, which means those three sub-slots form one slot. The <strong>deficit</strong> is the number of blocks still necessary to end the slot: this is described in more detail in  <a title="Section 3.9: Overflow Blocks and Weight" href="/docs/03consensus/overflow_blocks#minimum-block-requirement">Section 3.9</a>.</p><p>At the end of the slot, the challenge chain is combined with the infused challenge chain to generate the new challenge c2, which is used to start the challenge chain for the next sub-slot.</p><p>The only block which affects the challenge chain (and thus the PoSpace lottery) is the first block in the slot, which here is B1. In fact, it&#x27;s only a deterministic part of B1 called &quot;cc B1&quot;, which only depends on challenge chain data. An attacker who wants to grind cannot change the challenge by withholding B2, B3, or any other block apart from the first one.</p><p>An honest farmer who holds the first block (B1) will release it. If an attacker controls the first block (B1), they have two additional options: delay it or withhold it.</p><ul><li>Delay it: In order to know whether the new challenge will benefit them, they will need to execute the VDF all the way up to c2. By that time, their chance to get included in the reward chain is gone, since honest farmers sign only one block per proof of space.</li><li>Withhold it: This does not provide much benefit to the attacker, since they must release it before sp2 in order to get the farmers on their chain. Farmers will choose the heaviest chain, which is the one with the most (heaviest) reward chain blocks.</li></ul><p>Why do we commit to any blocks at all in the challenge chain? If we did not, an attacker with a faster VDF could look ahead, since they would not need the help of honest participants in order to compute the challenge chain into the future. The challenge chain would be totally deterministic. This would enable some advantage by replotting. Furthermore, the challenge chain can be used to probabilistically prove the weight of the reward chain to light clients, without sharing all reward chain blocks (since the challenge chain depends on the “best” block in the slot, you can calculate the number of reward chain blocks).</p><p>For a block to be considered valid, it has to provide VDFs for the challenge chain and reward chain, and optionally for the infused challenge chain if it is present. Forcing all VDFs to be included means that all three chains are guaranteed to move forward at the same rate.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="definitions"></a>Definitions<a class="hash-link" href="#definitions" title="Direct link to heading">#</a></h2><p><strong>Challenge chain</strong>: The VDF chain based on each challenge for each sub-slot, which does not infuse anything in the middle of each sub-slot. The challenges are also used for the proofs of space. The signage points in this chain are used for the SP filter.</p><p><strong>Reward chain</strong>: The VDF chain that contains infusions of all blocks. This chain pulls in the challenge chain, and optionally, the infused challenge chain at the end of each sub-slot.</p><p><strong>Infused challenge chain</strong>: A VDF chain which starts at the first block infused in a slot (which is not based on the previous slot’s challenge, this is called the challenge block) and ends at the end of the slot.
This increases security by preventing VDF lookahead attacks.</p><p><strong>Sub-slot</strong>: a period of time for which a timelord must run a VDF. The number of calculations the timelord must perform (sub-slot_iterations) to complete the sub-slot are adjusted periodically (and automatically) to take around 10 minutes. During this time, 64 signage points will be released and the entire network will submit an average of 32 valid proofs of space.</p><p><strong>Slot</strong>: one or more sub-slots. The important thing to remember is that a slot requires at least 16 reward-chain blocks. If these blocks are not produced in the first sub-slot, then another sub-slot will be required within the same slot. At the end of the slot, the infused challenge chain stops, the challenge chain pulls in the result of the infused challenge chain, and the deficit is reset to 16.</p><p><strong>Block</strong>: a block is a collection of data infused into the rewards chain which contains: a proof of space for a challenge hash with fewer iterations than the slot iterations, signage point and infusion point VDFs for both chains, optional infusion point VDF for the infused challenge chain, and a rewards address. Some blocks are also transaction blocks. There is a maximum of 128 blocks per slot.</p><p><strong>Transaction Block</strong>: A block that is eligible to create transactions, along with an associated list of transactions.</p><p><strong>Challenge block</strong>: The first block to be infused in each slot, which is not based on a previous slot&#x27;s challenge. The challenge block always has a deficit of 15, and always starts off the infused challenge chain.</p><p><strong>Peak</strong>: The peak of the blockchain as seen by a node is the block with the greatest weight. Weight is the sum of the difficulty of a block and all its ancestors, which is similar to height, but a shorter chain can have heavier weight, due to difficulty adjustments.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Chia-Network/chia-docs/blob/main/docs/03consensus/three_vdf_chains.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/03consensus/multiple_blocks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 3.7 Multiple Blocks</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/03consensus/overflow_blocks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">3.9 Overflow Blocks and Weight »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#definitions" class="table-of-contents__link">Definitions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Approach</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/approach" target="_blank" rel="noopener noreferrer" class="footer__link-item">White Paper</a></li></ul></div><div class="col footer__col"><div class="footer__title">Technology</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/greenpaper" target="_blank" rel="noopener noreferrer" class="footer__link-item">Green Paper</a></li><li class="footer__item"><a href="https://www.chia.net/assets/Chia-New-Consensus-0.9.pdf" target="_blank" rel="noopener noreferrer" class="footer__link-item">Consensus 1.1</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/grants" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants</a></li><li class="footer__item"><a href="https://www.chialisp.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chialisp</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items"><li class="footer__item"><a href="https://chia.net/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About</a></li><li class="footer__item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://chia.net/contact" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2022 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chia-docs/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://www.chia.net/terms">Terms</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.73889518.js"></script>
<script src="/assets/js/main.7dba6002.js"></script>
</body>
</html>