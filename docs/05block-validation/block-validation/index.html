<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">5.1 Block Validation | Chia Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://cpp6d.github.io/chia-docs//docs/05block-validation/block-validation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="5.1 Block Validation | Chia Documentation"><meta data-react-helmet="true" name="description" content="Block validation in Chia is composed of two parts: header validation and body validation."><meta data-react-helmet="true" property="og:description" content="Block validation in Chia is composed of two parts: header validation and body validation."><link data-react-helmet="true" rel="shortcut icon" href="/img/chia_leaf_green.svg"><link data-react-helmet="true" rel="canonical" href="https://cpp6d.github.io/chia-docs//docs/05block-validation/block-validation"><link data-react-helmet="true" rel="alternate" href="https://cpp6d.github.io/chia-docs//docs/05block-validation/block-validation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cpp6d.github.io/chia-docs//docs/05block-validation/block-validation" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.864117c7.css">
<link rel="preload" href="/assets/js/runtime~main.73889518.js" as="script">
<link rel="preload" href="/assets/js/main.7dba6002.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/chia-docs-icon.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/chia-docs-icon.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title"> Chia Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/01introduction/what-is-chia">Docs</a><a href="https://www.chia.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia.net</a><a href="https://github.com/Chia-Network/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia Github</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">1 - Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">2 - Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">3 - Consensus Algorithm</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">4 - Coin Set Model</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">5 - Block Validation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/05block-validation/block-validation">5.1 Block Validation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/05block-validation/block_format">5.2 Block format</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/05block-validation/block_rewards">5.3 Block rewards</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">6 - Mempool</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">7 - Networking</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">8 - Serialization</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">9 - Keys and Signatures</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">10 - Protocol</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">11 - Pool Protocol</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">12 - RPC APIs</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">13 - Command Line Interface</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">14 - Python Implementation</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">15 - Resources</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>5.1 Block Validation</h1></header><p>Block validation in Chia is composed of two parts: header validation and body validation.</p><p>The header validation performs consensus algorithm-related checks, such as proof of space and time, signage points and infusion points, previous block hashes, foliage hashes, and timestamps. Notably, it does not validate any CLVM, coin spends, or signatures. Usually, for efficiency, light clients will want to validate headers but not the body.</p><p>Body validation entails running all puzzles for spent coins, reading the coin database, verifying signatures, checking for duplicate or invalid removals and additions, etc.</p><p>Validating a block in Chia will require access to some blocks in the past, up to a maximum theoretical value of three times the max number of blocks in a slot (3x128=384), but usually only a few are needed. Also, information regarding previous sub-epochs and epochs is needed for validation, as well as the current system timestamp. Implementations
can cache only some recent blocks instead of storing all blocks in memory. <code>chia-blockchain</code> maintains a database of BlockRecords, which contain only the important pieces of block information required for validating future blocks.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="full-sync-vs-normal-operation"></a>Full Sync vs Normal Operation<a class="hash-link" href="#full-sync-vs-normal-operation" title="Direct link to heading">#</a></h2><p>There are two cases when a node might verify blocks.</p><ol><li>During a full sync, where the node is trying to catch up to the most recent block, starting from an old block height. In this case, the node is able to download many blocks at once.</li><li>During normal operation, where the node is caught up to the most recent block, and is only downloading one block every few seconds.</li></ol><p>We&#x27;ll cover both of these cases below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="full-sync"></a>Full Sync<a class="hash-link" href="#full-sync" title="Direct link to heading">#</a></h3><p>Full sync is the process by which a full node downloads and validates all of the blocks in the blockchain and catches up to the most recent block. Full sync is important, because it allows new nodes to validate that a blockchain is the heaviest -- and thus, the currently valid -- chain. It allows everyone to come to consensus on the current state, regardless of when they come online, or for how long they go offline.</p><p>The method of full sync can vary between implementations, but the high level algorithm is the following:</p><ol><li>Connect to other peers on the network, by querying the DNS introducer, and crawling the network.</li><li>Check the current weight of the peak of the peers, and select a few peers to sync from.</li><li>Download and validate a weight proof, to ensure that the given peak has real work behind it.</li><li>Download and validate all blocks in the blockchain, in batches.</li></ol><p>Weight proofs are important, because they prevent other peers from lying to us about what the heaviest peak is. They also prevent us from downloading potentially useless data. Once the full node is caught up to the blockchain, it can properly farm, access the coin state, etc.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="normal-operation"></a>Normal Operation<a class="hash-link" href="#normal-operation" title="Direct link to heading">#</a></h3><p>Normal operation is the process by which a full node continuously gossips and receives blocks with other peers, always following the heaviest peak. If our node is at weight 2000, and we see that a peer has a peak at weight 2100, then we fetch that block from the peer. Usually, this is done in two phases:</p><ol><li>The unfinished block is propagated across the network, along with all information up to the signage point, transactions, etc.</li><li>The finished block, which includes infusion point VDFs, is also propagated. This typically excludes the transactions, which were already sent in step 1.</li></ol><p>Normal operation is much less CPU-intensive than full sync, since there is only one block every 18 seconds, and one transaction block every 52 seconds, on average. Low-power machines like the Raspberry PI 4 should be able to easily continue normal operation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="block-validation-steps"></a>Block Validation Steps<a class="hash-link" href="#block-validation-steps" title="Direct link to heading">#</a></h2><p>The following sections list all of the required checks to ensure validity of a block. Please note that the official protocol and specification are defined by the <code>chia-blockchain</code>
<a href="https://github.com/Chia-Network/chia-blockchain/tree/main/chia/consensus" target="_blank" rel="noopener noreferrer">Python implementation</a>, and NOT by this documentation page.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="header-validation"></a>Header Validation<a class="hash-link" href="#header-validation" title="Direct link to heading">#</a></h3><ol><li>Check that the previous block exists in the blockchain, or that it is genesis.</li><li>Check finished slots that have been crossed since <code>prev_b</code>= the previous block in the chain.<ul><li>Check sub-slot challenge hash for genesis block.</li><li>Check sub-slot challenge hash for non-genesis block.</li><li>Check sub-slot challenge hash for empty slot.</li><li>Validate that genesis block has no ICC=Infused challenge chain.</li><li>Validate that there is not icc iff icc_challenge hash is None.</li><li>Check infused challenge chain sub-slot VDF.</li><li>Check infused challenge sub-slot hash in challenge chain, deficit 16.</li><li>Check infused challenge sub-slot hash not included for other deficits.</li><li>Check infused challenge sub-slot hash in reward sub-slot.</li><li>If no icc, check that the cc=challenge chain doesn&#x27;t include it.</li><li>If no icc, check that the rc=reward chain doesn&#x27;t include it.</li><li>Check sub-epoch summary hash is None for empty slots.</li><li>Check new difficulty and ssi if applicable.</li><li>Check new difficulty and ssi are None if we don&#x27;t finish epoch.</li><li>Check challenge sub-slot hash in reward sub-slot.</li><li>Check end of reward slot VDF.</li><li>Check challenge chain sub-slot VDF.</li><li>Check deficit (MIN_SUB.. deficit edge case for genesis block)</li><li>If prev sb had deficit 0, resets deficit to MIN_BLOCK_PER_CHALLENGE_BLOCK</li><li>Otherwise, deficit stays the same at the slot ends, cannot reset until 0</li></ul></li><li>Check sub-epoch summary<ul><li>Check that genesis block does not have sub-epoch summary</li><li>Check that we finished a slot and we finished a sub-epoch</li><li>Check the actual sub-epoch is correct</li><li>Check that we don&#x27;t have to include a sub-epoch summary</li></ul></li><li>Check if the number of blocks is less than the max</li><li>Check proof of space</li><li>Check signage point index</li><li>Check required iters</li><li>check signage point index 0 has no cc sp and no rc sp</li><li>Check no overflows in the first sub-slot of a new epoch</li><li>Check total iters</li><li>Check reward chain sp proof</li><li>Check reward chain sp signature</li><li>Check cc sp vdf</li><li>Check cc sp sig</li><li>Check is_transaction_block</li><li>Check foliage block signature by plot key</li><li>Check foliage block signature by plot key</li><li>Check unfinished reward chain block hash</li><li>Check pool target max height</li><li>Check pre-farm puzzle hashes for genesis block.<ul><li>If pospace has a pool pk, check pool target signature. Should not check this for genesis block.</li><li>Otherwise, the plot is associated with a contract puzzle hash, not a public key, so check pool contract ph</li></ul></li><li>Check extension data if applicable. None for mainnet.</li><li>Check if foliage block is present</li><li>Check foliage block hash</li><li>Check prev block hash for genesis and non-genesis</li><li>The filter hash in the Foliage Block must be the hash of the filter</li><li>The timestamp in Foliage Block must not be over 5 minutes in the future, and the timestamp must be greater than the previous transaction block timestamp</li><li>Check block height for genesis and non-genesis</li><li>Check block weight for genesis and non-genesis</li><li>Check challenge chain infusion point VDF</li><li>Check reward chain infusion point VDF</li><li>Check infused challenge chain infusion point VDF</li><li>Check reward block hash</li><li>Check reward block is_transaction_block</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="body-validation"></a>Body Validation<a class="hash-link" href="#body-validation" title="Direct link to heading">#</a></h3><ol><li>For non transaction-blocs: foliage block, transaction filter, transactions info, and generator must
be empty. If it is a block but not a transaction block, there is no body to validate. Check that all fields are
None, and return.</li><li>For blocks, foliage block, transactions info must not be empty.</li><li>The transaction info hash in the Foliage block must match the transaction info.</li><li>The foliage block hash in the foliage block must match the foliage block.</li><li>The reward claims must be valid for the previous blocks, and current block fees.</li><li>No transactions before INITIAL_TRANSACTION_FREEZE timestamp (this check has been removed).</li><li>The generator root must be the hash of the serialized bytes of the generator for this block (or zeroes if no generator)</li><li>Check the transactions generator reference list:<ul><li>The generator_ref_list must be the hash of the serialized bytes of</li><li>the generator ref list for this block (or &#x27;one&#x27; bytes [0x01] if no generator)</li><li>The generator ref list length must be less than or equal to MAX_GENERATOR_REF_LIST_SIZE entries</li><li>The generator ref list must not point to a height &gt;= this block&#x27;s height</li><li>If we have a generator reference list, we must have a generator</li><li>Check that cost &lt;= MAX_BLOCK_COST_CLVM</li><li>The CLVM program must not return any errors</li></ul></li><li>Check that the correct cost is in the transactions info</li><li>Check additions for max coin amount (be careful to check for 64 bit overflows in other languages. This is the max 64 bit unsigned integer)</li><li>Validate addition and removal merkle set roots.</li><li>The additions and removals must result in the correct filter.</li><li>Check for duplicate outputs in additions.</li><li>Check for duplicate spends inside block.</li><li>Check if removals exist and were not previously spent. (coin_db up to the fork point + fork block + this_block).
Be careful with forks and with ephemeral coins (added and removed in same block).</li><li>Check that the total coin amount for added is &lt;= removed.</li><li>Check that the assert fee sum &lt;= fees, and that each reserved fee is non-negative.</li><li>Check that the fee amount + farmer reward &lt; maximum coin amount.</li><li>Check that the computed fees are equal to the fees in the block header.</li><li>Verify that removed coin puzzle_hashes match with calculated puzzle_hashes.</li><li>Verify CLVM conditions.</li><li>Verify aggregated signature.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Chia-Network/chia-docs/blob/main/docs/05block-validation/block-validation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/04coin-set-model/addresses"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« 4.4 Addresses</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/05block-validation/block_format"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">5.2 Block format Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#full-sync-vs-normal-operation" class="table-of-contents__link">Full Sync vs Normal Operation</a><ul><li><a href="#full-sync" class="table-of-contents__link">Full Sync</a></li><li><a href="#normal-operation" class="table-of-contents__link">Normal Operation</a></li></ul></li><li><a href="#block-validation-steps" class="table-of-contents__link">Block Validation Steps</a><ul><li><a href="#header-validation" class="table-of-contents__link">Header Validation</a></li><li><a href="#body-validation" class="table-of-contents__link">Body Validation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Approach</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/approach" target="_blank" rel="noopener noreferrer" class="footer__link-item">White Paper</a></li></ul></div><div class="col footer__col"><div class="footer__title">Technology</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/greenpaper" target="_blank" rel="noopener noreferrer" class="footer__link-item">Green Paper</a></li><li class="footer__item"><a href="https://www.chia.net/assets/Chia-New-Consensus-0.9.pdf" target="_blank" rel="noopener noreferrer" class="footer__link-item">Consensus 1.1</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items"><li class="footer__item"><a href="https://www.chia.net/grants" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants</a></li><li class="footer__item"><a href="https://www.chialisp.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chialisp</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items"><li class="footer__item"><a href="https://chia.net/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About</a></li><li class="footer__item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://chia.net/contact" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Â© 2022 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chia-docs/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://www.chia.net/terms">Terms</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.73889518.js"></script>
<script src="/assets/js/main.7dba6002.js"></script>
</body>
</html>